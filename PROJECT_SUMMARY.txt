â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  NEXUS LEGAL INTEGRATION v2.1 - RESUMEN                      â•‘
â•‘                  Middleware ClickUp â†’ Cloud SQL + API                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ STACK TECNOLÃ“GICO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  âœ“ Python 3.11+
  âœ“ FastAPI (async web framework)
  âœ“ SQLAlchemy 2.0 (ORM)
  âœ“ PostgreSQL 15 + pg_trgm (fuzzy search)
  âœ“ Google Cloud Run (serverless hosting)
  âœ“ Cloud SQL (managed PostgreSQL)
  âœ“ Secret Manager (credentials)
  âœ“ Alembic (database migrations)

ğŸ“ ESTRUCTURA DEL PROYECTO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
clickupmendoza/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py                  # FastAPI app principal
â”‚   â”œâ”€â”€ config.py                # ConfiguraciÃ³n (Pydantic)
â”‚   â”œâ”€â”€ database.py              # SQLAlchemy setup
â”‚   â”œâ”€â”€ api/                     # Endpoints REST
â”‚   â”‚   â”œâ”€â”€ webhooks.py          # POST /webhooks/clickup
â”‚   â”‚   â””â”€â”€ leads.py             # GET /leads/search, etc.
â”‚   â”œâ”€â”€ core/                    # Parsing y normalizaciÃ³n
â”‚   â”‚   â”œâ”€â”€ parser.py            # ExtracciÃ³n con regex
â”‚   â”‚   â”œâ”€â”€ normalizer.py        # NormalizaciÃ³n de nombres
â”‚   â”‚   â””â”€â”€ text_utils.py        # Utilidades de texto
â”‚   â”œâ”€â”€ services/                # LÃ³gica de negocio
â”‚   â”‚   â”œâ”€â”€ lead_service.py      # Transformaciones
â”‚   â”‚   â””â”€â”€ clickup_service.py   # Cliente API ClickUp
â”‚   â”œâ”€â”€ repositories/            # Acceso a datos
â”‚   â”‚   â””â”€â”€ lead_repository.py   # CRUD + bÃºsqueda fuzzy
â”‚   â”œâ”€â”€ models/                  # ORM models
â”‚   â”‚   â””â”€â”€ lead.py              # LeadsCache table
â”‚   â””â”€â”€ schemas/                 # Pydantic schemas
â”‚       â”œâ”€â”€ lead.py              # Response validation
â”‚       â””â”€â”€ webhook.py           # Webhook validation
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ init_db.py               # InicializaciÃ³n DB
â”‚   â””â”€â”€ load_historical_data.py  # ETL desde CSV
â”œâ”€â”€ alembic/                     # Migraciones DB
â”œâ”€â”€ Dockerfile                   # Imagen Docker
â”œâ”€â”€ cloudbuild.yaml              # CI/CD Google Cloud
â”œâ”€â”€ deploy.sh                    # Script de deployment
â”œâ”€â”€ requirements.txt             # Dependencias Python
â”œâ”€â”€ Makefile                     # Comandos comunes
â”œâ”€â”€ README.md                    # DocumentaciÃ³n principal
â”œâ”€â”€ QUICKSTART.md                # GuÃ­a rÃ¡pida de inicio
â”œâ”€â”€ ARCHITECTURE.md              # Arquitectura tÃ©cnica
â””â”€â”€ API_EXAMPLES.md              # Ejemplos de uso

ğŸ”„ FLUJOS PRINCIPALES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1ï¸âƒ£  WEBHOOK INGEST (Tiempo Real)
   ClickUp â†’ POST /webhooks/clickup â†’ Validar firma â†’ Fetch task completa
   â†’ Parse + Normalize â†’ Upsert en Cloud SQL

2ï¸âƒ£  BÃšSQUEDA FUZZY (MCP/API)
   Cliente â†’ GET /leads/search?q=nombre â†’ Normalizar query
   â†’ SQL: WHERE nombre_normalizado % 'query' â†’ Retornar top N

3ï¸âƒ£  BOOTSTRAP HISTÃ“RICO (ETL)
   CSV files â†’ load_historical_data.py â†’ Parse cada fila
   â†’ Transform â†’ Upsert batch en DB

4ï¸âƒ£  SAFETY NET (Job Nocturno)
   Cloud Scheduler â†’ ClickUp API (delta Ãºltimas 24h)
   â†’ Transform â†’ Upsert â†’ Captura webhooks perdidos

ğŸ¯ CARACTERÃSTICAS PRINCIPALES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… Parsing Inteligente
   â€¢ Extrae campos de texto libre (regex)
   â€¢ Normaliza nombres (ASCII, mayÃºsculas)
   â€¢ Valida telÃ©fonos (10-15 dÃ­gitos)
   â€¢ Limpia fechas (elimina ordinales)

âœ… BÃºsqueda Fuzzy (pg_trgm)
   â€¢ Tolerante a typos: "Peres" â†’ "Perez"
   â€¢ Orden flexible: "Juan Perez" â‰ˆ "Perez Juan"
   â€¢ Score de similitud (0.0 - 1.0)
   â€¢ Ãndice GIN para performance

âœ… Arquitectura por Capas
   â€¢ API â†’ Services â†’ Core â†’ Repositories â†’ Models
   â€¢ SeparaciÃ³n de responsabilidades
   â€¢ FÃ¡cil testing y mantenimiento

âœ… Cloud Native
   â€¢ Scale-to-zero (ahorro de costos)
   â€¢ Secrets Manager (seguridad)
   â€¢ Cloud SQL (managed DB)
   â€¢ HTTPS/TLS por default

ğŸš€ QUICK START
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

LOCAL:
  1. python3.11 -m venv .venv && source .venv/bin/activate
  2. pip install -r requirements.txt
  3. Editar .env con credenciales
  4. createdb nexus_legal_db
  5. python scripts/init_db.py
  6. uvicorn app.main:app --reload --port 8080
  7. Abrir http://localhost:8080/docs

CLOUD RUN:
  1. gcloud config set project YOUR_PROJECT_ID
  2. Crear Cloud SQL instance + database
  3. Configurar secrets (API tokens, DB password)
  4. Editar cloudbuild.yaml (reemplazar variables)
  5. ./deploy.sh
  6. Configurar webhook en ClickUp

ğŸ“Š API ENDPOINTS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  GET  /                           Health check
  GET  /docs                       Swagger UI (documentaciÃ³n)
  GET  /leads/search?q=X&limit=N   BÃºsqueda fuzzy por nombre
  GET  /leads/{task_id}            Obtener lead por ID de ClickUp
  GET  /leads/mycase/{id}          Obtener lead por MyCase ID
  GET  /leads/?skip=0&limit=100    Listar todos (paginado)
  POST /webhooks/clickup           Webhook de ClickUp (interno)

ğŸ”§ COMANDOS ÃšTILES (Makefile)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  make install        Instalar dependencias
  make dev            Servidor de desarrollo
  make init-db        Inicializar base de datos
  make migrate-up     Aplicar migraciones
  make deploy         Desplegar a Cloud Run
  make clean          Limpiar archivos temporales
  make help           Ver todos los comandos

ğŸ›¡ï¸  SEGURIDAD
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  âœ“ Secrets en Secret Manager (nunca en cÃ³digo)
  âœ“ HTTPS/TLS obligatorio
  âœ“ ValidaciÃ³n de webhook signatures
  âœ“ SQL injection prevention (ORM)
  âœ“ Cloud SQL encriptaciÃ³n en reposo
  âœ“ PII protection (casos VAWA)

ğŸ“ˆ LÃ“GICA DE PARSING (Ejemplo)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INPUT (task_content):
  Name: Juan PÃ©rez
  Phone: (555) 123-4567
  Email: juan@example.com
  
  Other result of interview (optional):
  Cliente califica para VAWA.
  Evidencia documentada.
  
  Type of Interview: Individual

OUTPUT (parsed):
  full_name_extracted: "Juan PÃ©rez"
  phone_raw: "(555) 123-4567"
  phone_number: "5551234567"           # Validado
  email_extracted: "juan@example.com"
  interview_other: "Cliente califica..."
  interview_type: "Individual"

NORMALIZACIÃ“N (task_name):
  INPUT:  "LÃ³pez GarcÃ­a | 12345678"
  OUTPUT:
    nombre_clickup: "LÃ³pez GarcÃ­a"
    id_mycase: "12345678"
    nombre_normalizado: "LOPEZ GARCIA"  # Para bÃºsqueda fuzzy

ğŸ“š DOCUMENTACIÃ“N
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  README.md          DocumentaciÃ³n completa del proyecto
  QUICKSTART.md      GuÃ­a rÃ¡pida de inicio (< 10 min)
  ARCHITECTURE.md    Arquitectura tÃ©cnica detallada
  API_EXAMPLES.md    Ejemplos de uso de la API
  /docs              Swagger UI interactivo (runtime)

ğŸ—ºï¸  ROADMAP (Opcional)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  â˜ Sync a Google Sheets (reportes)
  â˜ Job nocturno con Cloud Scheduler
  â˜ ExtracciÃ³n de comentarios de ClickUp
  â˜ Dashboard de mÃ©tricas (Looker Studio)
  â˜ Tests unitarios (pytest)
  â˜ CI/CD con GitHub Actions

âœ… CHECKLIST DE DEPLOYMENT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  â˜ Crear proyecto en GCP
  â˜ Crear Cloud SQL instance (PostgreSQL 15)
  â˜ Crear base de datos + usuario
  â˜ Habilitar extensiÃ³n pg_trgm
  â˜ Ejecutar script init_db.py
  â˜ Configurar secrets en Secret Manager
  â˜ Editar cloudbuild.yaml (PROJECT_ID, REGION, INSTANCE)
  â˜ Ejecutar ./deploy.sh
  â˜ Obtener URL del servicio (Cloud Run)
  â˜ Configurar webhook en ClickUp apuntando a URL/webhooks/clickup
  â˜ Verificar health check (GET /)
  â˜ Probar bÃºsqueda (GET /leads/search?q=test)
  â˜ (Opcional) Cargar datos histÃ³ricos con load_historical_data.py
  â˜ (Opcional) Configurar Cloud Scheduler para safety net job

ğŸ“ SOPORTE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Para problemas o preguntas, contactar al equipo de desarrollo.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
VersiÃ³n: 2.1.0 | Fecha: 2026-01-05 | Stack: Python 3.11 + FastAPI + Cloud Run
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
